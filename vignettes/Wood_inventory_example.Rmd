---
title: "Domestic wood use inventory"
output:
  bookdown::html_document2: default
  bookdown::pdf_document: 
    fig_caption: yes
    keep_tex: no
    number_sections: yes
  header-includes:
    \usepackage{longtable}
    \usepackage{float}
    \usepackage{booktabs}
    \usepackage{siunitx}
 
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, collapse = TRUE, comment = "#>")
library(novaInventories)
library(knitr)
library(magrittr)
library(tidyverse)
library(VGAM)
library(scales)
load("~/Anglo/System/RDAs/indicators.Rda")
source('~/novaInventories/R/tibble.indicator.R')
load("~/Anglo/System/RDAs/CHS.Rda")
```

# Populations

## Population estimate
Population estimates for each town is shown in Table \ref{tab:pop}. The uncertainty in the estimate is modeled by a uniform distribution ranging from the best estimate minus 10% to the best estimate plus 10%. 

```{r}
N_HHS2020 <- bind_rows(
  tibble.indicator.plek(indicators$mortimer$ga_ramosidi_sp_sefikile_p1$N_HHS2020),
  tibble.indicator.plek(indicators$mortimer$sefikile_p2$N_HHS2020),
  tibble.indicator.plek(indicators$mortimer$northam_ext_5_ext_7$N_HHS2020),
  tibble.indicator.plek(indicators$mortimer$mantserre_sp$N_HHS2020),
  tibble.indicator.plek(indicators$waterval$bokamoso_sp$N_HHS2020),
  tibble.indicator.plek(indicators$waterval$mfidikoe_sp$N_HHS2020),
  tibble.indicator.plek(indicators$waterval$waterkloof_sp$N_HHS2020)
) %>% unnest(val) %>%
  mutate(N_HHS2020 = map(val, ~maak_distlist(
    nm = "N_HHS2020",
    dist = "unif",
    params = c(min = . - .%/%10, max = . + .%/%10) ))) %>%
  select(site, town, N_HHS2020)
```

```{r fig.cap="\\label{tab:pop} Population estimates per town"}
kable(N_HHS2020 %>% mutate(distribution = map_chr(N_HHS2020, ~.@dist),
                     min = map_dbl(N_HHS2020, ~.@params[[1]]), 
                     max = map_dbl(N_HHS2020, ~.@params[[2]]),
                     site = Hmisc::capitalize(site),
                     town = Hmisc::capitalize(town)
                     ) %>% 
  select(-N_HHS2020))
```

## Proportion of households who use wood

```{r}
PERC_HHS_WOOD_SUMMR_CHS2020 <- bind_rows(
  tibble.indicator.plek(indicators$mortimer$ga_ramosidi_sp_sefikile_p1$PERC_HHS_WOOD_SUMMR_CHS2020),
  tibble.indicator.plek(indicators$mortimer$sefikile_p2$PERC_HHS_WOOD_SUMMR_CHS2020),
  tibble.indicator.plek(indicators$mortimer$northam_ext_5_ext_7$PERC_HHS_WOOD_SUMMR_CHS2020),
  tibble.indicator.plek(indicators$mortimer$mantserre_sp$PERC_HHS_WOOD_SUMMR_CHS2020),
  tibble.indicator.plek(indicators$waterval$bokamoso_sp$PERC_HHS_WOOD_SUMMR_CHS2020),
  tibble.indicator.plek(indicators$waterval$mfidikoe_sp$PERC_HHS_WOOD_SUMMR_CHS2020),
  tibble.indicator.plek(indicators$waterval$waterkloof_sp$PERC_HHS_WOOD_SUMMR_CHS2020)
) %>% unnest(val) %>%
  mutate(PERC_HHS_WOOD_SUMMR_CHS2020 = map2(n, PointEst, ~maak_distlist(
    nm = "PERC_HHS_WOOD_SUMMR_CHS2020",
    dist = "norm" ,
    params = c(mean = ..2/100, sd = (..2/100 * (1 -..2/100))/..1 )
    ))) %>%
  select(site, town, PERC_HHS_WOOD_SUMMR_CHS2020) %>% 
  rename("PERC" = "PERC_HHS_WOOD_SUMMR_CHS2020")
```

Figure \ref{fig:tabpropdist} shows the distributions used to model the proportion of households in each town who use wood. The normal distributionwas chosen because the binomial distribution can be modelled by the normal distribution if the sample size is large. 

```{r tabpropdist, fig.cap="\\label{fig:tabpropdist}"}
PERC_HHS_WOOD_SUMMR_CHS2020 %>% 
  mutate(distribution = map_chr(PERC, ~.@dist),
         mean = map_dbl(PERC, ~.@params[[1]]),
         sd = map_dbl(PERC, ~.@params[[2]]),
         site = Hmisc::capitalize(site),
          town = Hmisc::capitalize(town)
               ) %>% 
  select(-PERC) %>% kable(digits = 5)
```


# Results of the fire logs

```{r logtabs}
sef_log_tab <- indicators$mortimer$sefikile_p2$PERC_FIRES_PPURPOSE_PCOMM_SUMMR_FLB2020@val
mf_log_tab <- indicators$waterval$mfidikoe_sp$PERC_FIRES_PPURPOSE_PCOMM_SUMMR_FLB2020@val
```

Fire logs were keps by 20 households each in Sefikile and Mfidikwe. A total of `r sum(sef_log_tab$n)` fires were logged in Sefikile and `r sum(mf_log_tab$n)` in Mfidikwe. 

## Purpose of ingition

A breakdown of the reasons for making fire is shown in Figure \ref{fig:logpurposemort} for Sefikile and in Figure \ref{fig:logpurposewat} for Mfidikwe. Cooking and heating water for bathing seems to be more or less equally important. 

```{r logpurposemort, fig.cap="\\label{logpurposemort}", out.width="100%"}
indicators$mortimer$sefikile_p2$PERC_FIRES_PPURPOSE_PCOMM_SUMMR_FLB2020@plots[[2]]
```

```{r logpurposewat, fig.cap="\\label{logpurposewat}", out.width="100%"}
indicators$waterval$mfidikoe_sp$PERC_FIRES_PPURPOSE_PCOMM_SUMMR_FLB2020@plots[[2]]
```

## Timing of fires

Figure \ref{fig:diurnal} shows the number of fires logged per hour of the day. 

In Sefikile, the period with the mose fires are 06:00 and 07:00 in the morning. The number of fires decline after 07:00 (with small sub-peaks at 11:00 and 14:00) to each a day-time low at 15:00. Starting from 15:00 the number of fires increase to reach a afternoon peak at 17:00 that rapidly decline to 0 at 22:00. 

In Mfidikwe, the highest number of fires occur in the morning around 08:00. The early morning peak starts slowly between 04:00 and 04:00 and then increases rapidly around 06:00 to finally peak at 08:00. A smaller peak occurs around mid-day and a somewhat larger peak occurs at 16:00. The afternoon peak already starts at 14:00. By 20:00, new fire activity stops. 

```{r}
dfTimeFrameM <- expand_grid(site = c("mortimer"), town = c("ga_ramosidi_sp_sefikile_p1", "sefikile_p2", "northam_ext_5_ext_7", "mantserre_sp"), response = 0:23)
dfTimeFrameW <- expand_grid(site = c("waterval"), town = c("bokamoso_sp", "mfidikoe_sp", "waterkloof_sp"), response = 0:23)
dfTimeFrame <- bind_rows(dfTimeFrameM, dfTimeFrameW) %>% group_by(site, town)
```

```{r}
xh <- bind_rows(
  tibble.indicator.plek(indicators$mortimer$sefikile_p2$PERC_IGNIT_PHH_BYHOD_SUMMR_FLB2020),
  tibble.indicator.plek(indicators$waterval$mfidikoe_sp$PERC_IGNIT_PHH_BYHOD_SUMMR_FLB2020)) %>%
  unnest(val) %>%
  mutate(response = as.integer(response)) %>%
  right_join(dfTimeFrame %>% filter(town == "mfidikoe_sp" | town == "sefikile_p2")) %>%
  mutate(n = ifelse(is.na(n), 0, n),
         perc = ifelse(is.na(perc), 0.001, perc),
         nn = sum(n)) %>%
  arrange(site, town, response) %>%
  select(site, town, response, nn, n, perc) %>%
  mutate(PH1 = map2(nn, perc, ~maak_distlist(
    nm = "PH1",
    dist = "norm" ,
    params = c(mean = ..2/100, sd = (..2/100 * (1 -..2/100))/..1 )
    #dist = "pois",
    #params = c(lambda = ..1/100 * ..2)
  )))
```

```{r diurnal, fig.cap = "\\label{fig:diurnal}", out.width="100%"}
mxh <- xh %>% 
  group_by(site, town) %>%
  mutate(res = map2(PH1, n, ~roep_param(..1, n = 100))) %>% 
  unnest(res) %>% 
  mutate(id = rep(1:100, 24)) 

dfplot <- mxh %>%
  select(-n, -nn, -PH1, -perc) %>% 
  rename("hod" = "response",
         "perc_fires" = "res") %>% 
  mutate(hod = as_factor(hod))


ggplot(data = dfplot, aes(x = hod, y = perc_fires, group = (id), color = id)) + 
  geom_line() + 
  facet_wrap(~town, nrow = 2)
```

```{r}
PERC_IGNIT_PHH_BYHOD_SUMMR_FLB2020 <- bind_rows(
  tibble.indicator.plek(indicators$mortimer$sefikile_p2$PERC_IGNIT_PHH_BYHOD_SUMMR_FLB2020),
  tibble.indicator.plek(indicators$waterval$mfidikoe_sp$PERC_IGNIT_PHH_BYHOD_SUMMR_FLB2020)
) %>% unnest(val) %>% 
  rename("hod" = "response") %>% 
  mutate(hod = as_factor(as.integer(hod))) %>% 
  arrange(hod) 
```

# Estimate of wood consumption from Comprehensive Household Survey

## Summer results

The comprehensive household survey contains questions of wood use in summer and winter. Respondents were asked if they used wood at all. Those who did use wood were asked in what format they buy their wood and how made units of each format they use in atypical winter and summer month. Estimated weights for each format was then used to calculate monthly wood consumption in each season. Figure \ref{fig:CHSSUMM} shows the results of this esitmation per summer month.

```{r}
KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020 <- bind_rows(
  tibble.indicator.plek(indicators$mortimer$ga_ramosidi_sp_sefikile_p1$KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020),
  tibble.indicator.plek(indicators$mortimer$sefikile_p2$KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020),
  tibble.indicator.plek(indicators$mortimer$northam_ext_5_ext_7$KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020),
  tibble.indicator.plek(indicators$mortimer$mantserre_sp$KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020),
  tibble.indicator.plek(indicators$waterval$bokamoso_sp$KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020),
  tibble.indicator.plek(indicators$waterval$mfidikoe_sp$KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020),
  tibble.indicator.plek(indicators$waterval$waterkloof_sp$KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020)
  ) 
```

```{r fig.cap="\\label{fig:CHSSUMM}"}
KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020 %>% 
  unnest(val) %>% 
  select(-name, -description) %>% 
  select(site, town, everything()) %>% 
  kable()
```

```{r}
KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020 %<>%
  unnest(val) %>%
  mutate(KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020 = map(Mean, ~maak_distlist(
    nm = "KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020",
    dist = "zipois" ,
    params = c(lambda = ., pstr0 = 0.1) ))) %>%
  select(site, town, KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020)
```

```{r out.width="100%"}
dfSummerCHS <- left_join(N_HHS2020, PERC_HHS_WOOD_SUMMR_CHS2020) %>%
  left_join(KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020 ) %>%
  mutate(ll  = pmap(., ~list(N = ..3, p = ..4, KG = ..5)),
         res = map2(ll, town, ~monticarleer(..1, "N_HHS2020 * PERC_HHS_WOOD_SUMMR_CHS2020 * KG_WOOD_PWOODHH_PMONTH_SUMMR_CHS2020",
                                            tbl_out = FALSE,
                                            saveplot = TRUE,
                                            fn = paste0("../man/figures/Wood_Summer_Month_CHS_", ..2, ".pdf")) )
  ) %>% unnest(res)%>%
  mutate(ss = map(res, ~broom::tidy(summary(.$Result))))
```

```{r}
dfSummerCHS %>% select(site, town, ss) %>% unnest(ss) %>% group_by(site, town) %>% kable(digit = 0)
```

```{r dfSummerCHSplot, fig.cap="\\label{fig:dfSummerCHSplot}", out.width="100%"}
ggplot(data = dfSummerCHS %>% 
         select(site, town, res) %>% unnest(res) %>% 
         arrange(site), aes(x = town, y = Result,fill = site)) + 
  geom_boxplot() + 
  facet_wrap(site~., scales = "free_x") +
  theme(legend.position = "none") + 
  theme(axis.text.x = element_text(angle = 35)) + 
  scale_y_continuous(labels = scales::comma)
```

## Winter results

# Estimate of wood consumption from Comprehensive Household Survey

## Mass of wood per fire

```{r}
KG_WOOD_PWOODHH_PFIRE_SUMMR_M1_WWS2020 <- bind_rows(
  tibble.indicator.plek(indicators$mortimer$sefikile_p2$KG_WOOD_PWOODHH_PFIRE_SUMMR_M1_WWS2020),
  tibble.indicator.plek(indicators$waterval$mfidikoe_sp$KG_WOOD_PWOODHH_PFIRE_SUMMR_M1_WWS2020)
) %>% unnest(val) %>% 
  mutate(site = Hmisc::capitalize(site),
         town = Hmisc::capitalize(town))
```

The mass of wood per fire made as calculated from the wood weighing survey is given in Table \ref{tab:masswoodfire}. The mean wood use per fire in Sefikile was calculated at `r KG_WOOD_PWOODHH_PFIRE_SUMMR_M1_WWS2020$Mean[[1]]`kg and at `r KG_WOOD_PWOODHH_PFIRE_SUMMR_M1_WWS2020$Mean[[2]]`kg for Mfidikwe. 

```{r fig.cap="\\label{tab:masswoodfire}"}
kable(KG_WOOD_PWOODHH_PFIRE_SUMMR_M1_WWS2020 %>% 
        select(-name, -description) %>% 
        select(site, town, everything()))
```

The distribution of the mass of wood per fire is modelled as a normal distribution. This is shown in Table \ref{tab:masswooddistparams}. 

```{r}
KG_WOOD_PWOODHH_PFIRE_SUMMR_M1_WWS2020 %<>%
  mutate(KG = purrr::map2(Mean, `Std. Dev`, ~maak_distlist(
    nm = "KG_WOOD_PWOODHH_PFIRE_SUMMR_M1_WWS2020",
    dist = "norm",
    params = c(mean = ..1, sd = ..2) ))) %>%
  select(site, town, KG)
```

```{r fig.cap="\\label{tab:masswooddistparams} Distribution parameters for mass of wood used per day"}
kable(KG_WOOD_PWOODHH_PFIRE_SUMMR_M1_WWS2020 %>%
        mutate(distribution = map_chr(KG, ~.@dist),
               mean = map_dbl(KG, ~.@params[[1]]),
               sd = map_dbl(KG, ~.@params[[2]])
               ) %>%
  select(-KG))
```

## Number of fires made per month

indicators$mortimer$sefikile_p2$N_FIRES_PWOODHH_PDAY_SUMMR_FLB2020

```{r}
N_FIRES_PWOODHH_PDAY_SUMMR_FLB2020 <- bind_rows(
  tibble.indicator.plek(indicators$mortimer$sefikile_p2$N_FIRES_PWOODHH_PDAY_SUMMR_FLB2020),
  tibble.indicator.plek(indicators$waterval$mfidikoe_sp$N_FIRES_PWOODHH_PDAY_SUMMR_FLB2020)
) %>% unnest(val) %>% 
  mutate(site = Hmisc::capitalize(site),
         town = Hmisc::capitalize(town))
```

```{r}
kable(N_FIRES_PWOODHH_PDAY_SUMMR_FLB2020 %>% 
        select(-name, -description) %>% 
        select(site, town, everything()))
```

```{r}
N_FIRES_PWOODHH_PDAY_SUMMR_FLB2020 %<>%
  mutate(N_fpd = purrr::map2(Mean, `Std. Dev`, ~maak_distlist(
    nm = "N_fpd",
    dist = "lnorm",
    params = c(meanlog = log(..1), sdlog = abs(log(..2))) ))) %>%
  select(site, town, N_fpd)
N_FIRES_PWOODHH_PDAY_SUMMR_FLB2020$N_fpd[[2]]@params <- c(meanlog = log(0.73), sdlog = abs(log(0.68)))# hand edit : gebruik mediaan as gemiddeld en ander plek se sd
```

```{r}
N_FIRES_PWOODHH_PDAY_SUMMR_FLB2020 %>% 
  mutate(distribution = map_chr(N_fpd, ~.@dist),
        logmean = map_dbl(N_fpd, ~.@params[[1]]),
        sdmean = map_dbl(N_fpd, ~.@params[[2]])
         ) %>% 
  select(-N_fpd) %>% 
  kable(digits = 4)
```


## Result: Method 1 for wood weights

```{r}
dfSummerWWS <- left_join(N_HHS2020, PERC_HHS_WOOD_SUMMR_CHS2020) %>%
  mutate(site = Hmisc::capitalize(site),
         town = Hmisc::capitalize(town)) %>% 
  left_join(KG_WOOD_PWOODHH_PFIRE_SUMMR_M1_WWS2020) %>% 
  left_join(N_FIRES_PWOODHH_PDAY_SUMMR_FLB2020) %>% 
  filter(town == "Sefikile_p2" | town == "Mfidikoe_sp") %>% 
  mutate(ll  = pmap(., ~list( N_HH=..3, PERC =..4,  KG = ..5, N_fpd = ..6 )),
         res = map2(ll, town, ~monticarleer(..1, "(N_HHS2020 * PERC_HHS_WOOD_SUMMR_CHS2020) * (KG_WOOD_PWOODHH_PFIRE_SUMMR_M1_WWS2020 * N_fpd * 30.4)",
                                            tbl_out = FALSE,
                                            saveplot = TRUE,
                                            fn = paste0("../man/figures/Wood_Summer_Month_WWS_", ..2, ".pdf")) )
  ) %>% unnest(res)%>%
  mutate(ss = map(res, ~broom::tidy(summary(.$Result))))
```

```{r}
dfSummerWWS %>% select(site, town, ss) %>% unnest(ss) %>% group_by(site, town) %>% kable(digit = 0)
```

```{r}
ggplot(data = dfSummerWWS %>% 
         select(site, town, res) %>% unnest(res) %>% 
         arrange(site), aes(x = town, y = Result,fill = site)) + 
  geom_boxplot() + 
  facet_wrap(site~., scales = "free_x") +
  theme(legend.position = "none") + 
  theme(axis.text.x = element_text(angle = 35)) + 
  scale_y_continuous(labels = scales::comma)
```


## Monthly mass of wood 

```{r}
KG_WOOD_PWOODHH_PMONTH_SUMMR_M2_WWS2020 <- bind_rows(
  tibble.indicator.plek(indicators$mortimer$sefikile_p2$KG_WOOD_PWOODHH_PMONTH_SUMMR_M2_WWS2020),
  tibble.indicator.plek(indicators$waterval$mfidikoe_sp$KG_WOOD_PWOODHH_PMONTH_SUMMR_M2_WWS2020)) %>%
  unnest(val) %>%
  mutate(KG = map(Mean, ~maak_distlist(
    nm = "KG_WOOD_PWOODHH_PMONTH_SUMMR_M2_WWS2020",
    dist = "pois" ,
    params = c(lambda = .) ))) %>%
  select(site, town, KG)
```


```{r}
dfSummerWWS_M2 <- left_join(N_HHS2020, PERC_HHS_WOOD_SUMMR_CHS2020) %>%
  left_join(KG_WOOD_PWOODHH_PMONTH_SUMMR_M2_WWS2020 ) %>%
  filter(town == "sefikile_p2" | town == "mfidikoe_sp") %>%
  mutate(ll  = pmap(., ~list(N = ..3, p = ..4, KG = ..5)),
         res = map2(ll, town, ~monticarleer(..1, "N_HHS2020 * PERC_HHS_WOOD_SUMMR_CHS2020 * KG_WOOD_PWOODHH_PMONTH_SUMMR_M2_WWS2020",
                                     tbl_out = FALSE,
                                     saveplot = TRUE,
                                     fn = paste0("../man/figures/Wood_Summer_Month_WWS_M2_", ..2, ".pdf")))
  ) %>% unnest(res)
```

```{}
# dfSummerWWS_M2 %>% select(site, town, res) %>% group_by(site, town) %>%
#   mutate(ss = map(res, ~broom::tidy(summary(.$Result)))) %>%
#   select(-res) %>% unnest(ss)
```

### Mass of wood per fires 

The mass of 

```{r}
KG_WOOD_PWOODHH_PFIRE_SUMMR_M2_WWS2020 <- bind_rows(
  tibble.indicator.plek(indicators$mortimer$sefikile_p2$KG_WOOD_PWOODHH_PFIRE_SUMMR_M2_WWS2020),
  tibble.indicator.plek(indicators$waterval$mfidikoe_sp$KG_WOOD_PWOODHH_PFIRE_SUMMR_M2_WWS2020)) %>%
  unnest(val) %>%
  mutate(KG_WOOD_PWOODHH_PFIRE_SUMMR_M2_WWS2020 = map(Mean, ~maak_distlist(
    nm = "KG_WOOD_PWOODHH_PFIRE_SUMMR_M2_WWS2020",
    dist = "pois" ,
    params = c(lambda = .) ))) %>%
  select(site, town, KG_WOOD_PWOODHH_PFIRE_SUMMR_M2_WWS2020)
```

```{r}
KG_WOOD_PWOODHH_PFIRE_SUMMR_M2_WWS2020 %>% 
  mutate(distribution = map_chr(KG_WOOD_PWOODHH_PFIRE_SUMMR_M2_WWS2020, ~.@dist),
                     lambda = map_dbl(KG_WOOD_PWOODHH_PFIRE_SUMMR_M2_WWS2020, ~.@params)
                     ) %>% 
  select(-KG_WOOD_PWOODHH_PFIRE_SUMMR_M2_WWS2020) %>% 
  kable()
```

```{r}
N_FIRES_PWOODHH_PMONTH_SUMMR_FLB2020 <- bind_rows(
  tibble.indicator.plek(indicators$mortimer$sefikile_p2$N_FIRES_PWOODHH_PMONTH_SUMMR_FLB2020),
  tibble.indicator.plek(indicators$waterval$mfidikoe_sp$N_FIRES_PWOODHH_PMONTH_SUMMR_FLB2020)
) %>% unnest(val) %>%
  mutate(N_FIRES_PWOODHH_PMONTH_SUMMR_FLB2020 = map(Mean, ~maak_distlist(
    nm = "N_FIRES_PWOODHH_PMONTH_SUMMR_FLB2020",
    dist = "pois" ,
    params = c(lambda = .) ))) %>%
  select(site, town, N_FIRES_PWOODHH_PMONTH_SUMMR_FLB2020)
```

```{r}
N_FIRES_PWOODHH_PMONTH_SUMMR_FLB2020 %>% 
  mutate(distribution = map_chr(N_FIRES_PWOODHH_PMONTH_SUMMR_FLB2020, ~.@dist),
                     lambda = map_dbl(N_FIRES_PWOODHH_PMONTH_SUMMR_FLB2020, ~.@params)
                     ) %>% 
  select(-N_FIRES_PWOODHH_PMONTH_SUMMR_FLB2020) %>% 
  kable()
```


```{r}
dfSummerFLB <- left_join(N_HHS2020, KG_WOOD_PWOODHH_PFIRE_SUMMR_M2_WWS2020 ) %>%
  left_join(N_FIRES_PWOODHH_PMONTH_SUMMR_FLB2020 ) %>%
  filter(town == "sefikile_p2" | town == "mfidikoe_sp") %>%
  mutate(ll  = pmap(., ~list(N = ..3, p = ..4, KG = ..5)),
         res = map2(ll, town, ~monticarleer(..1, "N_HHS2020 * KG_WOOD_PWOODHH_PFIRE_SUMMR_M2_WWS2020 * N_FIRES_PWOODHH_PMONTH_SUMMR_FLB2020",
                                            tbl_out = FALSE,
                                            saveplot = TRUE,
                                            fn = paste0("../man/figures/Wood_Summer_Month_FLB_M2_", ..2, ".pdf"),
                                            nbin = 20)
         )
  ) %>% unnest(res)
```


```{r}
dfSummerFLB %>% select(site, town, res) %>% group_by(site, town) %>%
  mutate(ss = map(res, ~broom::tidy(summary(.$Result)))) %>%
  select(-res) %>% unnest(ss)
```


# #####################################################
# ##                   Winter                        #
# #####################################################
# 
# #indicators$mortimer$sefikile_p2$KG_WOOD_PWOODHH_PMONTH_SUMMR_M1_WWS2020
# 
# KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020 <- bind_rows(
#   tibble.indicator.plek(indicators$mortimer$ga_ramosidi_sp_sefikile_p1$KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020),
#   tibble.indicator.plek(indicators$mortimer$sefikile_p2$KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020),
#   tibble.indicator.plek(indicators$mortimer$northam_ext_5_ext_7$KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020),
#   tibble.indicator.plek(indicators$mortimer$mantserre_sp$KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020),
#   tibble.indicator.plek(indicators$waterval$bokamoso_sp$KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020),
#   tibble.indicator.plek(indicators$waterval$mfidikoe_sp$KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020),
#   tibble.indicator.plek(indicators$waterval$waterkloof_sp$KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020)
# ) %>% unnest(val) %>%
#   mutate(KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020 = map(Mean, ~maak_distlist(
#     nm = "KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020",
#     dist = "pois",
#     params = c(lambda = .) ))) %>%
#   select(site, town, KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020)
# 
# PERC_HHS_WOOD_WINTR_CHS2020 <- bind_rows(
#   tibble.indicator.plek(indicators$mortimer$ga_ramosidi_sp_sefikile_p1$PERC_HHS_WOOD_WINTR_CHS2020),
#   tibble.indicator.plek(indicators$mortimer$sefikile_p2$PERC_HHS_WOOD_WINTR_CHS2020),
#   tibble.indicator.plek(indicators$mortimer$northam_ext_5_ext_7$PERC_HHS_WOOD_WINTR_CHS2020),
#   tibble.indicator.plek(indicators$mortimer$mantserre_sp$PERC_HHS_WOOD_WINTR_CHS2020),
#   tibble.indicator.plek(indicators$waterval$bokamoso_sp$PERC_HHS_WOOD_WINTR_CHS2020),
#   tibble.indicator.plek(indicators$waterval$mfidikoe_sp$PERC_HHS_WOOD_WINTR_CHS2020),
#   tibble.indicator.plek(indicators$waterval$waterkloof_sp$PERC_HHS_WOOD_WINTR_CHS2020)
# ) %>% unnest(val) %>%
#   mutate(p = map2(n, PointEst, ~maak_distlist(
#     nm = "PERC_HHS_WOOD_WINTR_CHS2020",
#     dist = "norm" ,
#     params = c(mean = ..2/100, sd = (..2/100 * (1 -..2/100))/..1 )
#     ))) %>%
#   select(site, town, p)
# 
# dfWinterCHS <- left_join(N_HHS2020, PERC_HHS_WOOD_WINTR_CHS2020) %>%
#   left_join(KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020 ) %>%
#   mutate(ll  = pmap(., ~list(N = ..3, p = ..4, KG = ..5)),
#          res = map2(ll, town, ~monticarleer(..1, "N_HHS2020 * PERC_HHS_WOOD_WINTR_CHS2020 * KG_WOOD_PWOODHH_PMONTH_WINTR_CHS2020",
#                                            tbl_out = FALSE,
#                                            saveplot = TRUE,
#                                            fn = paste0("man/figures/Wood_Winter_Month_CHS_", ..2, ".pdf")) )
#          ) %>%
#   unnest(res) %>%
#   mutate(ss = map(res, ~broom::tidy(summary(.$Result))))
# 
# dfWinterCHS %>% select(site, town, ss) %>% unnest(ss) %>% group_by(site, town)

```
